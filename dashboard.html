<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard FNEE</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <script src="[https://cdn.jsdelivr.net/npm/chart.js](https://cdn.jsdelivr.net/npm/chart.js)"></script>
    <link href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css)" rel="stylesheet">
    <style>
        /* ESTILO EJECUTIVO DARK MODE (Forzado) */
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; }
        
        /* Ocultar scrollbar para integración limpia */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }

        /* Tarjetas */
        .card { 
            background: #1e293b; 
            border: 1px solid #334155; 
            border-radius: 0.5rem; 
            box-shadow: none; 
        }

        /* Textos */
        .text-slate-700 { color: #e2e8f0 !important; } /* Títulos */
        .text-slate-500 { color: #94a3b8 !important; } /* Subtítulos */
        .text-slate-800 { color: #f8fafc !important; } /* Cifras fuertes */
        
        /* Colores de Marca */
        .text-blue-600 { color: #2dd4bf !important; } /* Teal Principal */
        .bg-blue-50 { background-color: rgba(45, 212, 191, 0.1) !important; color: #2dd4bf !important; }
        .text-emerald-600 { color: #34d399 !important; }

        /* Tablas */
        thead { background-color: #020617; }
        th { color: #94a3b8; font-weight: 600; }
        td { border-bottom: 1px solid #334155; }
        tr:hover { background-color: #334155 !important; }

        /* Inputs */
        input { 
            background-color: #0f172a !important; 
            border-color: #334155 !important; 
            color: white !important; 
        }

        /* Navegación Interna */
        .tab-active { background-color: #2dd4bf; color: #0f172a; border: none; }
        .tab-inactive { background-color: transparent; color: #94a3b8; border: 1px solid #334155; }
        
        /* Ocultar elementos no deseados */
        #btn-data, #view-data { display: none !important; } /* Adiós pestaña BBDD */
        nav { display: none !important; } /* Adiós navbar antigua */

        /* Animaciones */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4">

    <div class="flex justify-center space-x-4 mb-6">
        <button onclick="switchTab('dashboard')" id="btn-dashboard" class="tab-active px-6 py-2 rounded text-sm font-bold uppercase tracking-wide transition-all">
            <i class="fa-solid fa-chart-pie mr-2"></i> Mercado Global
        </button>
        <button onclick="switchTab('comparator')" id="btn-comparator" class="tab-inactive px-6 py-2 rounded text-sm font-bold uppercase tracking-wide transition-all">
            <i class="fa-solid fa-crosshairs mr-2"></i> Comparador
        </button>
    </div>

    <main class="max-w-7xl mx-auto">
        
        <div id="view-dashboard" class="fade-in">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="card p-6 border-l-4 border-l-teal-400">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Empresas Activas</p>
                    <h3 class="text-4xl font-bold text-white" id="kpi-total-companies">0</h3>
                </div>
                <div class="card p-6">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Volumen '24</p>
                    <h3 class="text-2xl font-bold text-white" id="kpi-total-sales">0 GWh</h3>
                </div>
                <div class="card p-6">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Coste FNEE Est.</p>
                    <h3 class="text-2xl font-bold text-blue-600" id="kpi-total-cost">0 M€</h3>
                </div>
                <div class="card p-6">
                    <p class="text-slate-500 text-xs font-bold uppercase mb-1">Top Growth</p>
                    <h3 class="text-lg font-bold text-white truncate" id="kpi-top-grower-name">-</h3>
                    <p class="text-emerald-600 font-bold text-xs" id="kpi-top-grower-val">+0 GWh</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="card lg:col-span-2 h-[600px] flex flex-col">
                    <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50">
                        <h3 class="font-bold text-white text-sm">RANKING COMERCIALIZADORAS</h3>
                        <input type="text" id="search-input" placeholder="Buscar..." class="px-3 py-1 rounded text-sm w-48" onkeyup="filterTable()">
                    </div>
                    <div class="overflow-auto flex-1 p-0">
                        <table class="w-full text-sm text-left">
                            <thead class="sticky top-0 z-10">
                                <tr>
                                    <th class="px-4 py-3">Empresa</th>
                                    <th class="px-4 py-3 text-right">Ventas '24</th>
                                    <th class="px-4 py-3 text-right">Trend</th>
                                </tr>
                            </thead>
                            <tbody id="companies-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card p-4 flex flex-col h-[600px]">
                    <h3 class="font-bold text-white mb-4 text-sm text-center">EVOLUCIÓN DEL MERCADO</h3>
                    <div class="flex-1 relative">
                        <canvas id="marketChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-comparator" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-[600px]">
                <div class="lg:col-span-1 flex flex-col gap-4">
                    <div class="card p-4">
                        <h3 class="font-bold text-white mb-2 text-xs uppercase">Añadir Competidor</h3>
                        <input type="text" id="comp-search" placeholder="Escribe nombre..." class="w-full px-3 py-2 rounded text-sm mb-2" onkeyup="searchCompetitor()">
                        <div id="comp-results" class="hidden bg-slate-800 border border-slate-700 rounded mt-1 max-h-32 overflow-y-auto absolute z-50 w-64 shadow-xl"></div>
                        <div id="selected-comps" class="space-y-2 mt-2"></div>
                    </div>
                    <div class="card p-4">
                        <button onclick="setChartMode('absolute')" id="mode-abs" class="w-full text-left px-3 py-2 rounded mb-2 text-xs font-bold tab-active">VOLUMEN (GWh)</button>
                        <button onclick="setChartMode('indexed')" id="mode-idx" class="w-full text-left px-3 py-2 rounded text-xs font-bold tab-inactive">CRECIMIENTO (%)</button>
                    </div>
                </div>
                <div class="lg:col-span-3 card p-4">
                    <div class="h-full relative">
                        <canvas id="comparatorChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // DATOS MUESTRA (Aquí pegaremos el excel luego)
        let DB = [
            { cif: "A81948077", name: "ENDESA ENERGÍA", sales: { 2020: 85210, 2024: 68500 } },
            { cif: "A80298896", name: "CEPSA COMERCIAL", sales: { 2020: 71631, 2024: 73200 } },
            { cif: "A95758389", name: "IBERDROLA CLIENTES", sales: { 2020: 51557, 2024: 46500 } },
            { cif: "A61797536", name: "NATURGY", sales: { 2020: 30751, 2024: 20100 } },
            { cif: "A95000295", name: "TOTALENERGIES", sales: { 2020: 14518, 2024: 26500 } },
            { cif: "B82846825", name: "ENERGIA XXI", sales: { 2020: 12968, 2024: 12300 } },
            { cif: "B83160994", name: "AXPO IBERIA", sales: { 2020: 14727, 2024: 10000 } }
        ];

        const YEARS = [2020, 2024];
        let marketChartInstance = null;
        let comparatorChartInstance = null;
        let selectedCompetitors = [];
        let comparatorMode = 'absolute';
        
        // Utils
        const fmtNum = n => new Intl.NumberFormat('es-ES', { maximumFractionDigits: 0 }).format(n);
        const fmtEur = n => new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(n);

        function switchTab(t) {
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-comparator').classList.add('hidden');
            document.getElementById('btn-dashboard').className = 'tab-inactive px-6 py-2 rounded text-sm font-bold uppercase tracking-wide transition-all';
            document.getElementById('btn-comparator').className = 'tab-inactive px-6 py-2 rounded text-sm font-bold uppercase tracking-wide transition-all';
            
            document.getElementById('view-' + t).classList.remove('hidden');
            document.getElementById('btn-' + t).className = 'tab-active px-6 py-2 rounded text-sm font-bold uppercase tracking-wide transition-all';
            
            if(t==='comparator') updateComparatorChart();
        }

        function renderDashboard() {
            let total24 = DB.reduce((sum, c) => sum + (c.sales[2024]||0), 0);
            let total20 = DB.reduce((sum, c) => sum + (c.sales[2020]||0), 0); // Simplificado para demo
            
            document.getElementById('kpi-total-companies').innerText = DB.length;
            document.getElementById('kpi-total-sales').innerText = fmtNum(total24) + ' GWh';
            document.getElementById('kpi-total-cost').innerText = fmtEur(total24 * 239000).slice(0,-2) + ' M€';

            // Table
            const tbody = document.getElementById('companies-table-body');
            tbody.innerHTML = '';
            DB.sort((a,b) => (b.sales[2024]||0) - (a.sales[2024]||0)).forEach(c => {
                let s24 = c.sales[2024]||0;
                let s20 = c.sales[2020]||0;
                let trend = s20 > 0 ? ((s24-s20)/s20)*100 : 0;
                let color = trend >= 0 ? 'text-emerald-400' : 'text-rose-400';
                tbody.innerHTML += `<tr>
                    <td class="px-4 py-3 font-bold text-slate-300">${c.name}</td>
                    <td class="px-4 py-3 text-right text-white font-mono">${fmtNum(s24)}</td>
                    <td class="px-4 py-3 text-right ${color} font-bold text-xs">${trend.toFixed(1)}%</td>
                </tr>`;
            });

            // Chart
            const ctx = document.getElementById('marketChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2020', '2024'],
                    datasets: [{ label: 'Mercado', data: [total20, total24], backgroundColor: '#2dd4bf', borderRadius: 4 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { grid: { color: '#334155' }, ticks: { color: '#94a3b8' } }, x: { grid: { display: false }, ticks: { color: '#94a3b8' } } }
                }
            });
        }

        // Init
        renderDashboard();
    </script>
</body>
</html>